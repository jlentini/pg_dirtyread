# run the testsuite on travis-ci.com
---
# versions to run on
env:
  - PG_SUPPORTED_VERSIONS=9.2
  - PG_SUPPORTED_VERSIONS=9.3
  - PG_SUPPORTED_VERSIONS=9.4
  - PG_SUPPORTED_VERSIONS=9.5
  - PG_SUPPORTED_VERSIONS=9.6
  - PG_SUPPORTED_VERSIONS=10
  - PG_SUPPORTED_VERSIONS=11
  - PG_SUPPORTED_VERSIONS=12
  - PG_SUPPORTED_VERSIONS=13

language: C
# we stay on xenial for now because bionic doesn't have PG9.2
dist: xenial
sudo: required

install:
  # upgrade to get newer apt.pg.o.sh file
  - sudo apt-get update
  - sudo apt-get install -y postgresql-common debhelper fakeroot
  # install required PostgreSQL packages (purging the existing installation first)
  - sudo /usr/share/postgresql-common/pgdg/apt.postgresql.org.sh -v $PG_SUPPORTED_VERSIONS -p -i

script:
  - pg_buildext updatecontrol
  - dpkg-buildpackage -us -uc -rfakeroot -b -d
  - for deb in ../*.deb; do echo "$deb:"; dpkg-deb --info $deb; dpkg-deb --contents $deb; done
  - sudo dpkg -i ../*.deb
  - pg_buildext -i '--locale=C.UTF-8' installcheck
